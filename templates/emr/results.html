{% extends "emr/base.html" %}

{% block content %}	
	<div align="center">
		<form action="{% url 'emr:results' %}" type="get">
			{% csrf_token %}
			<table>
				<tr><input type="text" id="searchstring" value="{{ searchresults.0.0 }}" name="searchstring" class="searchbox"/></tr>
				<tr><b>&</b></tr>
				<tr><input type="submit" name="search" value="Search" class="btna"/></tr>
			</table>			
		</form>
	</div>
	<p></p>
	<h2>Patient(s) matching "{{ searchresults.0.0 }}":</h1>
	<p></p>
	{% for tableresults in searchresults.1 %}
		<p></p>
		<table class="table" id="hor-minimalist-b">
			<thead>
				<tr>
					{% for columnname in tableresults.2 %}
						<th scope="col">{{ columnname }}</td>
					{% endfor %}
					<th  scope="col" width="5%">View</td>
					<th  scope="col" width="5%">Edit</td>
					<th  scope="col" width="5%">Delete</td>
				</tr>
			</thead>
			<tbody>
				{% if not tableresults.3 %}
					<tr>
						<td colspan="{{ tableresults.2|length|add:'+2' }}">No results found for this search</td>
					</tr>
				{% else %}
					{% for records in tableresults.3 %}
						<tr>
							{% for record in records %}
								{% if forloop.counter != 1 %}
									{% with record_id=records.0 %}
										<td><a href="{% url 'emr:patient' record_id %}">{{ record }}</a></td>
									{% endwith %}
								{% endif %}
							{% endfor %}
							{% with record_id=records.0 table_id=tableresults.1 %}
								<td width="5%"><a href="{% url 'emr:detail' table_id record_id %}" class="btna">View</a></td> 
								<td width="5%"><a href="{% url 'emr:edit' table_id record_id %}" class="btne">Edit</a></td> 
								<td width="5%"><a href="{% url 'emr:deleterecord' table_id record_id %}" class="btnd" onclick="return confirm('Are you sure you want to delete this record?')">Delete</a></td>
							{% endwith %}
						</tr>
					{% endfor %}			
				{% endif %}
			</tbody>
		</table>
		<p></p>
	{% endfor %}
	<p></p>
	<i>* This version of EasyNut is limited to 100 results per table. If you reached this limit and did not find anything relevant, refine your search</i> 
{% endblock %}